---
title: MySQL容量评估
list_number: false
categories:
  - MySQL
comments: true
description:
  - MySQL容量评估
date: 2016-10-28 11:11:35
updated: 2016-10-28 11:11:35
tags:
---

# 容量评估

## 性能容量评估
- 分析线上业务场景
- 评估数据库服务器所需性能指标
- 预估可能成为瓶颈的服务器资源
- 帮助数据库性能调优

## 数据库服务器硬件性能指标项
- 磁盘IO性能
- 内存容量
- CPU
- 网络吞吐量
- 磁盘容量  
![](/img/markdown-img-paste-20161028111633869.png)

## 数据库业务特点关键词

### OLTP/OLAP类型
- T = Transaction
- 面向广大用户，高并发，较短事务操作
- 互联网应该绝大部分属于OLTP
- OLTP看重服务器CPU，内存，写事务较多或内存不够则依赖磁盘IO
- A = Analytical
- 通常面向内部人员，大规模复杂查询
- OLAP看重磁盘扫描的IO能力，部分依赖内存排序

### 并发请求 - 衡量线上业务繁忙程度
- 业务高峰时数据库的每秒并发访问量是多少
- 通过应用服务器数量，连接池配置判断
- 通过产品估算初上线用户规模和用户增长速度判断
- 通过实际业务类型判断
- 并发量相关资源：`CPU`

### 读写比例 - 描述应用程序如何使用数据库
- 线上业务select只读与update/delete/insert写操作比例
- delete/update通常都是先读再写
- insert需要分区数据写入是持续insert还是大量导入数据
- 根据业务实际场景分析
- 多读场景相关资源：`内存`
- 多写场景相关资源：`磁盘IO`

### 数据量 - 总量
- 数据库服务器存储设备可扩容能力的上限
- 根据估算的业务量，写入模式，分析数据增长量
- 预估一个硬件升级周期内数据库可存放数据的总量，上线时要留好余量
- 数据总量相关资源：`磁盘容量`

### 冷热数据比 - 有用数据的实时集合
- 热数据，线上最新一定周期内将被反复访问的数据
- 冷数据，线上保存着的，最近不会被在线用户用到的数据
- 估算活跃用户量，数据增长量等预估热数据量
- 内存大小尽可能足够存放线上实时热数据
- 热数据相关资源：`内存`

### 数据分级存储 - 缓解线上磁盘空间压力
- 最新热数据确保放在内存中
- 还可能访问到的较早数据存放在线上库磁盘中
- 更早的不会常规访问的数据定期迁移至历史库中
- 区分哪些数据时效性强可以迁移
![](/img/markdown-img-paste-20161028113557257.png)

## 服务器资源选型 - 将可选方案列出来
  ![](/img/markdown-img-paste-20161028113800391.png)

### 案例一，网易云音乐曲库数据库服务器评估
- 用于存放线上数千万歌曲信息
- 确定属于OLTP线上类型数据库
- 并发请求量
  - 50台应用服务器，每台最大连接数100
  - 可能峰值5000qps，并发请求量较大
- CPU需求高
- 读写比例
  - 访问模式以用户列出歌单和播放歌曲时查询歌曲信息为主，用户只有只读查询
  - 写数据发生在录入新歌或修改歌曲信息时后台操作，写比例小，且为批量导入
  - 读写比100:1
- 数据总量
  - 估算每首歌信息8k，总计5000万，总量400G
  - 数据总量增长相对较慢
- 冷热数据
  - 5000万歌曲中大约40%可能被访问，10%属于热点歌曲
  - 热数据大约≤40G
- 数据分级存储需求
  - 由于没有用户产生的数据，歌曲信息无法分级存储
- 内存需求一般，≥40G
- 磁盘空间需求一般，≥400G
- 磁盘IO能力需求一般
- 网络流量要求，8k*2500/1024≈20MB/s,一般
![](/img/markdown-img-paste-20161028115127210.png)

### 案例二，网易理财销售数据库服务器评估
- 用于存放理财用户线上订单
- 确定属于OLTP线上类型数据库
- 业务场景有明显特征
  - 特定高息产品秒杀销售时间窗有大量并发订单写入
  - 平时只有少量订单查询需求，和较低的常规产品购买请求
- 评估应以满足最关键的业务高峰为基准
- 并发请求量
  - 秒杀期间持续时间短，但是并发量预估30台应用服务器月2000tps
- 读写比例
  - 高峰时写订单是主要开销操作
- CPU要求较高
- 磁盘IO要求很高
- 数据总量
  - 根据业务分析，订单属于写入瞬时量大，总量较小，单笔金额较高
  - 总量预估一年成交百万单级别，增长量较稳定
  - 判断数据存储需求小于200G
- 冷热数据
  - 峰值写入为主，内存要求存放热点期间产生的脏数据即可
- 数据分级存储需求
  - 用户订单业务约定页面展示最近半年订单，半年前的需要到历史查询页面专门查询
  - 因此可以做分级存储，迁移所有半年前订单至历史库
- 内存需求一般，≥30G
- 磁盘空间需求一般，≥200G
- 磁盘IO能力需求很高
- 网络要求较高
  - 并发流量较高
  - 响应速度要求高

 ![](/img/markdown-img-paste-20161028120225856.png)



----
Good luck!  
冬日暖阳
